<div class="container">
    <nav class="navbar-light nav-fijo">
        <ul class="navbar-nav">
            <li class="nav-item" *ngIf="factura.id != 0">
                <a class="nav-link" title="Guardar" href="#" role="button" (click)="recaudar($event)">
                    <mat-icon>save</mat-icon>
                </a>
            </li>
            <li class="nav-item" *ngIf="factura.id != 0 && factura.estado == 'RECAUDADA'">
                <a class="nav-link" title="Crear Factura Electronica" href="#" role="button"
                    (click)="crearFacturaElectronica($event)">
                    <mat-icon>point_of_sale</mat-icon>
                </a>
            </li>
            <ng-container *ngIf="factura.id!=0">
                <li class="nav-item" *ngIf="!verPanelCheques">
                    <a class="nav-link" title="ver Cheques" role="button" (click)="verPanelCheques = true">
                        <mat-icon>payments</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="verPanelCheques">
                    <a class="nav-link" title="Ocultar Cheques" role="button" (click)="verPanelCheques = false">
                        <mat-icon>subtitles_off</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="!verPanelDepositos">
                    <a class="nav-link" title="ver Depósitos" role="button" (click)="verPanelDepositos = true">
                        <mat-icon>receipt_long</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="verPanelDepositos">
                    <a class="nav-link" title="Ocultar Depósitos" role="button" (click)="verPanelDepositos = false">
                        <mat-icon>signal_cellular_no_sim</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="!verPanelTransferencias">
                    <a class="nav-link" title="ver Transferencias" role="button"
                        (click)="verPanelTransferencias = true">
                        <mat-icon>move_down</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="verPanelTransferencias">
                    <a class="nav-link" title="Ocultar Transferencias" role="button"
                        (click)="verPanelTransferencias = false">
                        <mat-icon>move_up</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="!verPanelTarjetasCredito">
                    <a class="nav-link" title="ver T. Crédito" role="button" (click)="verPanelTarjetasCredito = true">
                        <mat-icon>add_card</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="verPanelTarjetasCredito">
                    <a class="nav-link" title="Ocultar T. Crédito" role="button"
                        (click)="verPanelTarjetasCredito = false">
                        <mat-icon>credit_card_off</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="!verPanelTarjetasDebito">
                    <a class="nav-link" title="ver T. Débito" role="button" (click)="verPanelTarjetasDebito = true">
                        <mat-icon>local_atm</mat-icon>
                    </a>
                </li>
                <li class="nav-item" *ngIf="verPanelTarjetasDebito">
                    <a class="nav-link" title="Ocultar T. Débito" role="button"
                        (click)="verPanelTarjetasDebito = false">
                        <mat-icon>money_off_csred</mat-icon>
                    </a>
                </li>
            </ng-container>
            <li class="nav-item">
                <a class="nav-link" title="Facturación" role="button" (click)="stepperPrevio(stepper)">
                    <mat-icon>undo</mat-icon>
                </a>
            </li>
        </ul>
    </nav>
    <div *ngIf="cargar">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
    <mat-divider></mat-divider>
    <!-- SECCIÓN EFECTIVO Y CRÉDITO -->
    <mat-accordion class="headers-align">
        <mat-expansion-panel (opened)="abrirPanelRecaudacion = true" (closed)="abrirPanelRecaudacion = false"
            [expanded]="abrirPanelRecaudacion">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <i><u>RECAUDACIÓN</u></i>
                </mat-panel-title>
                <mat-panel-description>
                    {{abrirPanelRecaudacion ? 'Ocultar sección' : 'Proceso de recaudación'}}
                    <mat-icon>account_circle</mat-icon>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-divider></mat-divider>
            <div class="form-group form-row">
                <div class="col-3">
                    <div class="centrar-titulo col-12 fondo">
                        <mat-label>EFECTIVO</mat-label>
                    </div>
                    <mat-divider></mat-divider>
                    <mat-card class="mat-elevation-z8">
                        <div class="form-row">
                            <div class="col-6">
                                <mat-form-field appearance="standard">
                                    <mat-label>Valor Factura</mat-label>
                                    <input matInput type="text" [(ngModel)]="factura.totalConDescuento"
                                        class="form-control-sm" [disabled]="true">
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="standard">
                                    <mat-label>Valor Pagado</mat-label>
                                    <input matInput type="text" [(ngModel)]="factura.totalRecaudacion"
                                        class="form-control-sm" [disabled]="true">
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="standard">
                                    <mat-label>Efectivo</mat-label>
                                    <input matInput type="text" [(ngModel)]="factura.efectivo"
                                        (change)="seleccionarEfectivo()" class="form-control-sm">
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="standard">
                                    <mat-label>Cambio</mat-label>
                                    <input matInput type="text" class="form-control-sm" [(ngModel)]="factura.cambio"
                                        [disabled]="true">
                                </mat-form-field>
                            </div>
                        </div>
                    </mat-card>
                </div>
                <div class="col-5">
                    <div class="centrar-titulo col-12 fondo">
                        <mat-label>CREDITO</mat-label>
                    </div>
                    <mat-divider></mat-divider>
                    <mat-card class="mat-elevation-z8">
                        <div class="form-row">
                            <div class="col-4">
                                <mat-form-field appearance="standard">
                                    <mat-label>Crédito</mat-label>
                                    <input matInput type="text" class="form-control-sm" [value]="factura.porPagar"
                                        [disabled]="true">
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="standard">
                                    <mat-label>Unidad de Tiempo</mat-label>
                                    <mat-select class="form-control-sm" [(ngModel)]="factura.credito.unidadTiempo" disabled>
                                        <mat-option *ngFor="let periodicidad of periodicidades"
                                            [value]="periodicidad.nombre">
                                            {{periodicidad.nombre}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="col-2">
                                <mat-form-field appearance="standard">
                                    <mat-label>Plazo</mat-label>
                                    <input matInput type="text" class="form-control-sm" disabled
                                        [(ngModel)]="factura.credito.plazo">
                                </mat-form-field>
                            </div>
                        </div>
                    </mat-card>
                </div>
                <div class="col-4">
                    <div class="centrar-titulo col-12 fondo">
                        <mat-label>FACTURA</mat-label>
                    </div>
                    <mat-divider></mat-divider>
                    <mat-card class="mat-elevation-z8">
                        <div class="form-row">
                            <div class="col-4">
                                <mat-form-field appearance="standard">
                                    <mat-label>Serie</mat-label>
                                    <input matInput type="text" class="form-control-sm" disabled
                                        [(ngModel)]="factura.serie">
                                </mat-form-field>
                            </div>
                            <div class="col-8">
                                <mat-form-field appearance="standard">
                                    <mat-label>No. Factura</mat-label>
                                    <input matInput type="text" class="form-control-sm" disabled
                                        [(ngModel)]="factura.secuencial">
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="standard">
                                    <mat-label>Fecha</mat-label>
                                    <input matInput type="text" value="{{factura.fecha | date:'dd-MM-yyyy'}}"
                                        class="form-control-sm" disabled>
                                </mat-form-field>
                            </div>
                            <div class="col-6">
                                <mat-form-field appearance="standard">
                                    <mat-label>Estado</mat-label>
                                    <mat-select [(ngModel)]="factura.estado" [disabled]="true" class="form-control-sm">
                                        <mat-option [value]="emitida">{{emitida}}</mat-option>
                                        <mat-option [value]="anulada">{{anulada}}</mat-option>
                                        <mat-option [value]="noFacturada">{{noFacturada}}</mat-option>
                                        <mat-option [value]="facturada">{{facturada}}</mat-option>
                                        <mat-option [value]="noRecaudada">{{noRecaudada}}</mat-option>
                                        <mat-option [value]="recaudada">{{recaudada}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>    
                    </mat-card>    
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>
    <!-- Sección CHEQUES -->
    <mat-accordion class="headers-align">
        <mat-expansion-panel (opened)="abrirPanelCheques = true" (closed)="abrirPanelCheques = false"
            [expanded]="abrirPanelCheques" *ngIf="verPanelCheques">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <i><u>CHEQUES</u></i>
                </mat-panel-title>
                <mat-panel-description>
                    {{abrirPanelCheques ? 'Ocultar cheques' : 'Recaudación con cheque'}}
                    <div class="derecha">Total en cheques: {{factura.totalCheques | currency}}</div>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-divider></mat-divider>
            <div class="form-group form-row">
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Fecha Cheque</mat-label>
                        <input matInput [matDatepicker]="picker1" class="form-control-sm" [(ngModel)]="cheque.fecha">
                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-datepicker #picker1></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Tipo Cheque</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="cheque.tipo">
                            <mat-option [value]="chequeALaVista">{{chequeALaVista}}</mat-option>
                            <mat-option [value]="chequePosfechado">{{chequePosfechado}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-4">
                    <mat-form-field appearance="standard">
                        <mat-label>Banco</mat-label>
                        <input matInput type="text" class="form-control-sm" [formControl]="controlBancoCheque"
                            [matAutocomplete]="bancoCheque">
                        <mat-autocomplete #bancoCheque="matAutocomplete" [displayWith]="verBanco">
                            <mat-option *ngFor="let banco of filtroBancos | async" [value]="banco">
                                {{banco.abreviatura}}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>No. Cheque</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="cheque.numero"
                            (blur)="rellenarNumeroCheque()">
                    </mat-form-field>
                </div>
                <div class="col-1">
                    <mat-form-field appearance="standard">
                        <mat-label>Valor</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="cheque.valor">
                    </mat-form-field>
                </div>
                <div class="col-1 iconos centrar">
                    <ng-container *ngIf="indiceCheque==menosUno">
                        <button mat-icon-button mat-button (click)="agregarCheque()">
                            <mat-icon>add</mat-icon>
                        </button>
                    </ng-container>
                    <ng-container *ngIf="indiceCheque!=menosUno">
                        <button mat-icon-button mat-button (click)="actualizarCheque()">
                            <mat-icon>update</mat-icon>
                        </button>
                    </ng-container>
                </div>
            </div>
            <div class="form-group form-row">
                <div class="mat-elevation-z8 col-12">
                    <table mat-table [dataSource]="dataSourceCheques" matSort #MatSortCheques="matSort">
                        <!-- Columnas Dinamicas -->
                        <ng-container *ngFor="let columna of columnasCheques" [matColumnDef]="columna.nombreColumna">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ columna.cabecera }} </th>
                            <td mat-cell *matCellDef="let row; let i=index">
                                <ng-container *ngIf="columna.nombreColumna!='acciones'">
                                    {{ columna.celda(row) }}
                                </ng-container>
                                <ng-container *ngIf="columna.nombreColumna=='acciones'">
                                    <button mat-icon-button color="warn" (click)="eliminarCheque(i)">
                                        <i class="fa fa-times mat-icon"></i>
                                    </button>
                                </ng-container>
                            </td>
                            <ng-container *ngIf="columna.nombreColumna!='valor'">
                                <td mat-footer-cell *matFooterCellDef> {{columna.pie}} </td>
                            </ng-container>
                            <ng-container *ngIf="columna.nombreColumna=='valor'">
                                <td mat-footer-cell *matFooterCellDef> {{factura.totalCheques | currency}} </td>
                            </ng-container>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="cabeceraCheques"></tr>
                        <tr mat-row *matRowDef="let row; let i=index; columns: cabeceraCheques"
                            (click)="seleccionCheque(row, i)" [class.selected-row]="clickedRowsCheques.has(row)"></tr>
                        <tr mat-footer-row *matFooterRowDef="cabeceraCheques"></tr>
                        <!-- Row shown when there is no matching data. -->
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="6">No hay cheques agregados</td>
                        </tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons
                        #MatPaginatorCheques="matPaginator"></mat-paginator>
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>
    <!-- Sección DEPOSITOS -->
    <mat-accordion class="headers-align">
        <mat-expansion-panel (opened)="abrirPanelDepositos = true" (closed)="abrirPanelDepositos = false"
            [expanded]="abrirPanelDepositos" *ngIf="verPanelDepositos">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <i><u>DEPÓSITOS</u></i>
                </mat-panel-title>
                <mat-panel-description>
                    {{abrirPanelDepositos ? 'Ocultar depósitos' : 'Recaudación con depósito'}}
                    <div class="derecha">Total en depósitos: {{calcularTotalDepositos() | currency}}</div>
                    <!--mat-icon>account_circle</mat-icon-->
                </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-divider></mat-divider>
            <div class="form-group form-row">
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Fecha</mat-label>
                        <input matInput [matDatepicker]="picker2" class="form-control-sm" [(ngModel)]="deposito.fecha">
                        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                        <mat-datepicker #picker2></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Bancos Propios</mat-label>
                        <mat-select [(ngModel)]="deposito.cuentaPropia.banco.abreviatura" 
                            (selectionChange)="consultarPorBanco(deposito.cuentaPropia.banco.abreviatura)" class="form-control-sm">
                            <mat-option *ngFor="let bancoPropio of bancosPropios" [value]="bancoPropio">
                                {{bancoPropio}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Cuenta</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="deposito.cuentaPropia">
                            <mat-option *ngFor="let cuentaPropia of cuentasPropias" [value]="cuentaPropia">
                                {{cuentaPropia.numero}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Tipo Cta.</mat-label>
                        <input matInput type="text" [(ngModel)]="deposito.cuentaPropia.tipoCuenta" 
                            class="form-control-sm" disabled>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>No. Comprobante</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="deposito.comprobante"
                            (blur)="rellenarNumeroDeposito()">
                    </mat-form-field>
                </div>
                <div class="col-1">
                    <mat-form-field appearance="standard">
                        <mat-label>Valor</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="deposito.valor">
                    </mat-form-field>
                </div>
                <div class="col-1 iconos centrar">
                    <ng-container *ngIf="indiceDeposito==menosUno">
                        <button mat-icon-button mat-button (click)="agregarDeposito()">
                            <mat-icon>add</mat-icon>
                        </button>
                    </ng-container>
                    <ng-container *ngIf="indiceDeposito!=menosUno">
                        <button mat-icon-button mat-button (click)="actualizarDeposito()">
                            <mat-icon>update</mat-icon>
                        </button>
                    </ng-container>
                </div>
            </div>
            <div class="form-group form-row">
                <div class="mat-elevation-z8 col-12">
                    <table mat-table [dataSource]="dataSourceDepositos" matSort #MatSortDepositos="matSort">
                        <!-- Columnas Dinamicas -->
                        <ng-container *ngFor="let columna of columnasDepositos" [matColumnDef]="columna.nombreColumna">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ columna.cabecera }} </th>
                            <td mat-cell *matCellDef="let row; let i=index">
                                <ng-container *ngIf="columna.nombreColumna!='acciones'">
                                    {{ columna.celda(row) }}
                                </ng-container>
                                <ng-container *ngIf="columna.nombreColumna=='acciones'">
                                    <button mat-icon-button color="warn" (click)="eliminarDeposito(i)">
                                        <i class="fa fa-times mat-icon"></i>
                                    </button>
                                </ng-container>
                            </td>
                            <ng-container *ngIf="columna.nombreColumna!='valor'">
                                <td mat-footer-cell *matFooterCellDef> {{columna.pie}} </td>
                            </ng-container>
                            <ng-container *ngIf="columna.nombreColumna=='valor'">
                                <td mat-footer-cell *matFooterCellDef> {{calcularTotalDepositos() | currency}} </td>
                            </ng-container>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="cabeceraDepositos"></tr>
                        <tr mat-row *matRowDef="let row; let i=index; columns: cabeceraDepositos"
                            (click)="seleccionDeposito(row, i)" [class.selected-row]="clickedRowsDepositos.has(row)"></tr>
                        <tr mat-footer-row *matFooterRowDef="cabeceraDepositos"></tr>
                        <!-- Row shown when there is no matching data. -->
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="6">No hay comprobantes de depositos agregados</td>
                        </tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons
                        #MatPaginatorDepositos="matPaginator"></mat-paginator>
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>

    <!-- Sección TRANSFERENCIAS -->
    <mat-accordion class="headers-align">
        <mat-expansion-panel (opened)="abrirPanelTransferencias = true" (closed)="abrirPanelTransferencias = false"
            [expanded]="abrirPanelTransferencias" *ngIf="verPanelTransferencias">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <i><u>TRANSFERENCIAS</u></i>
                </mat-panel-title>
                <mat-panel-description>
                    {{abrirPanelTransferencias ? 'Ocultar transferencias' : 'Recaudación con transferencia'}}
                    <div class="derecha">Total en transferencias: {{calcularTotalTransferencias() | currency}}</div>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-divider></mat-divider>
            <div class="form-group form-row">
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Fecha</mat-label>
                        <input matInput [matDatepicker]="picker3" class="form-control-sm"
                            [(ngModel)]="transferencia.fecha">
                        <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                        <mat-datepicker #picker3></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Tipo Transf.</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="transferencia.tipo">
                            <mat-option [value]="chequeALaVista">{{chequeALaVista}}</mat-option>
                            <mat-option [value]="chequePosfechado">{{chequePosfechado}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Bancos Propios</mat-label>
                        <mat-select [(ngModel)]="transferencia.cuentaPropia.banco.abreviatura" 
                            (selectionChange)="consultarPorBanco(deposito.cuentaPropia.banco.abreviatura)" class="form-control-sm">
                            <mat-option *ngFor="let bancoPropio of bancosPropios" [value]="bancoPropio">
                                {{bancoPropio}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Cuenta</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="transferencia.cuentaPropia">
                            <mat-option *ngFor="let cuentaPropia of cuentasPropias" [value]="cuentaPropia">
                                {{cuentaPropia.numero}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>No. Comprobante</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="transferencia.comprobante"
                            (blur)="rellenarNumeroTransferencia()">
                    </mat-form-field>
                </div>
                <div class="col-1">
                    <mat-form-field appearance="standard">
                        <mat-label>Valor</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="transferencia.valor">
                    </mat-form-field>
                </div>
                <div class="col-1 iconos centrar">
                    <ng-container *ngIf="indiceTransferencia==menosUno">
                        <button mat-icon-button mat-button (click)="agregarTransferencia()">
                            <mat-icon>add</mat-icon>
                        </button>
                    </ng-container>
                    <ng-container *ngIf="indiceTransferencia!=menosUno">
                        <button mat-icon-button mat-button (click)="actualizarTransferencia()">
                            <mat-icon>update</mat-icon>
                        </button>
                    </ng-container>
                </div>
            </div>
            <div class="form-group form-row">
                <div class="mat-elevation-z8 col-12">
                    <table mat-table [dataSource]="dataSourceTransferencias" matSort #MatSortTransferencias="matSort">
                        <!-- Columnas Dinamicas -->
                        <ng-container *ngFor="let columna of columnasTransferencias" [matColumnDef]="columna.nombreColumna">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ columna.cabecera }} </th>
                            <td mat-cell *matCellDef="let row; let i=index">
                                <ng-container *ngIf="columna.nombreColumna!='acciones'">
                                    {{ columna.celda(row) }}
                                </ng-container>
                                <ng-container *ngIf="columna.nombreColumna=='acciones'">
                                    <button mat-icon-button color="warn" (click)="eliminarTransferencia(i)">
                                        <i class="fa fa-times mat-icon"></i>
                                    </button>
                                </ng-container>
                            </td>
                            <ng-container *ngIf="columna.nombreColumna!='valor'">
                                <td mat-footer-cell *matFooterCellDef> {{columna.pie}} </td>
                            </ng-container>
                            <ng-container *ngIf="columna.nombreColumna=='valor'">
                                <td mat-footer-cell *matFooterCellDef> {{calcularTotalTransferencias() | currency}} </td>
                            </ng-container>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="cabeceraTransferencias"></tr>
                        <tr mat-row *matRowDef="let row; let i=index; columns: cabeceraTransferencias"
                            (click)="seleccionTransferencia(row, i)" [class.selected-row]="clickedRowsTransferencias.has(row)"></tr>
                        <tr mat-footer-row *matFooterRowDef="cabeceraTransferencias"></tr>
                        <!-- Row shown when there is no matching data. -->
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="6">No hay comprobantes de transferencia agregados</td>
                        </tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons
                        #MatPaginatorTransferencias="matPaginator"></mat-paginator>
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>

    <!-- Sección TARJETA DE CRÉDITO -->
    <mat-accordion class="headers-align">
        <mat-expansion-panel (opened)="abrirPanelTarjetasCredito = true" (closed)="abrirPanelTarjetasCredito = false"
            [expanded]="abrirPanelTarjetasCredito" *ngIf="verPanelTarjetasCredito">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <i><u>TARJETAS DE CRÉDITO</u></i>
                </mat-panel-title>
                <mat-panel-description>
                    {{abrirPanelTarjetasCredito ? 'Ocultar pagos con tarjeta de crédito' : 'Recaudación con tarjeta de crédito'}}
                    <div class="derecha">Total tarjetas de crédito: {{factura.totalTarjetasCreditos | currency}}</div>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-divider></mat-divider>
            <div class="form-group form-row">
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Franquicia</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="tarjetaCredito.franquiciaTarjeta">
                            <mat-option *ngFor="let franquiciaTarjeta of franquiciasTarjetasCreditos"
                                [value]="franquiciaTarjeta">
                                {{franquiciaTarjeta.nombre}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-3">
                    <mat-form-field appearance="standard">
                        <mat-label>Banco</mat-label>
                        <mat-autocomplete #bancoTarjetaCredito="matAutocomplete" [displayWith]="verBancoTarjetaCredito">
                            <mat-option *ngFor="let banco of filtroBancosTarjetasCreditos | async" [value]="banco">
                                {{banco.razonSocial}}
                            </mat-option>
                        </mat-autocomplete>
                        <input matInput type="text" class="form-control-sm" [formControl]="controlBancoTarjetaCredito"
                            [matAutocomplete]="bancoTarjetaCredito">
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Cédula</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="tarjetaCredito.identificacion"
                            (change)="validarIdentificacionTarjetaCredito()"
                            [disabled]="deshabilitarTitularTarjetaCredito">
                    </mat-form-field>
                </div>
                <div class="col-3">
                    <mat-form-field appearance="standard">
                        <mat-label>Nombre</mat-label>
                        <input matInput type="text" [(ngModel)]="tarjetaCredito.nombre"
                            [disabled]="deshabilitarTitularTarjetaCredito"
                            oninput="this.value = this.value.toUpperCase()" class="form-control-sm">
                    </mat-form-field>
                </div>
                <div class="col-1">
                    <mat-form-field appearance="standard">
                        <mat-label>Titular</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="tarjetaCredito.titular"
                            (selectionChange)="asignarTitularTarjetaCredito()">
                            <mat-option [value]="si">{{si}}</mat-option>
                            <mat-option [value]="no">{{no}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-1">
                    <mat-form-field appearance="standard">
                        <mat-label>Diferido</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="tarjetaCredito.diferido">
                            <mat-option [value]="si">{{si}}</mat-option>
                            <mat-option [value]="no">{{no}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Operador</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="tarjetaCredito.operadorTarjeta">
                            <mat-option *ngFor="let operadorTarjeta of operadoresTarjetasCreditos"
                                [value]="operadorTarjeta">
                                {{operadorTarjeta.nombre}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Lote</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="tarjetaCredito.lote">
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Valor</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="tarjetaCredito.valor"
                            [disabled]="true">
                    </mat-form-field>
                </div>
                <div class="col-1 iconos centrar">
                    <ng-container *ngIf="indiceTarjetaCredito==menosUno">
                        <button mat-icon-button mat-button (click)="agregarTarjetaCredito()">
                            <mat-icon>add</mat-icon>
                        </button>
                    </ng-container>
                    <ng-container *ngIf="indiceTarjetaCredito!=menosUno">
                        <button mat-icon-button mat-button (click)="confirmarEditarTarjetaCredito()">
                            <mat-icon>create</mat-icon>
                        </button>
                    </ng-container>
                </div>
            </div>
            <mat-divider></mat-divider>
            <div class="form-row">
                <div class="mat-elevation-z8 col-12">
                    <table mat-table [dataSource]="dataSourceTarjetasCreditos" matSort>
                        <!-- Posicion Columna -->
                        <ng-container matColumnDef="id">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>No.</th>
                            <td mat-cell *matCellDef="let i=index"> {{i+1}} </td>
                            <td mat-footer-cell *matFooterCellDef> Total </td>
                        </ng-container>
                        <!-- Franquicia Columna -->
                        <ng-container matColumnDef="franquicia">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Franquicia</th>
                            <td mat-cell *matCellDef="let tarjetaCredito">
                                {{tarjetaCredito.franquiciaTarjeta.nombre}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Banco Columna -->
                        <ng-container matColumnDef="banco">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Banco</th>
                            <td mat-cell *matCellDef="let tarjetaCredito"> {{tarjetaCredito.banco.abreviatura}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Cedula Columna -->
                        <ng-container matColumnDef="identificacion">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Cédula </th>
                            <td mat-cell *matCellDef="let tarjetaCredito"> {{tarjetaCredito.identificacion}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Numero Columna -->
                        <ng-container matColumnDef="nombre">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Propietario </th>
                            <td mat-cell *matCellDef="let tarjetaCredito"> {{tarjetaCredito.nombre}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Titular Columna -->
                        <ng-container matColumnDef="titular">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Titular </th>
                            <td mat-cell *matCellDef="let tarjetaCredito">{{tarjetaCredito.titular}}</td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Diferido Columna -->
                        <ng-container matColumnDef="diferido">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Diferido </th>
                            <td mat-cell *matCellDef="let tarjetaCredito">{{tarjetaCredito.diferido}}</td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Operador Columna -->
                        <ng-container matColumnDef="operador">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Operador</th>
                            <td mat-cell *matCellDef="let tarjetaCredito"> {{tarjetaCredito.operadorTarjeta.nombre}}
                            </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Lote Columna -->
                        <ng-container matColumnDef="lote">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Lote</th>
                            <td mat-cell *matCellDef="let tarjetaCredito"> {{tarjetaCredito.lote}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Valor Columna -->
                        <ng-container matColumnDef="valor">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Valor </th>
                            <td mat-cell *matCellDef="let tarjetaCredito"> {{tarjetaCredito.valor | currency}} </td>
                            <td mat-footer-cell *matFooterCellDef> {{factura.totalTarjetasCreditos | currency}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Acciones </th>
                            <td mat-cell *matCellDef="let i=index">
                                <button mat-raised-button color="primary" focusable="false"
                                    (click)="editarTarjetaCredito(i)">
                                    Editar
                                </button>&nbsp;
                                <button mat-raised-button color="warn" focusable="false"
                                    (click)="eliminarTarjetaCredito(i)">
                                    Eliminar
                                </button>
                            </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="columnasTarjetasCredito"></tr>
                        <tr mat-row *matRowDef="let row; columns: columnasTarjetasCredito;"></tr>
                        <tr mat-footer-row *matFooterRowDef="columnasTarjetasCredito"></tr>
                    </table>
                    <ng-container>
                        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
                    </ng-container>
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>

    <!-- Sección TARJETA DE DEBITO -->
    <mat-accordion class="headers-align">
        <mat-expansion-panel (opened)="abrirPanelTarjetasDebito = true" (closed)="abrirPanelTarjetasDebito = false"
            [expanded]="abrirPanelTarjetasDebito" *ngIf="verPanelTarjetasDebito">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <i><u>TARJETAS DE DÉBITO</u></i>
                </mat-panel-title>
                <mat-panel-description>
                    {{abrirPanelTarjetasDebito ? 'Ocultar pagos con tarjeta de débito' : 'Recaudación con tarjeta de
                    débito'}}
                    <div class="derecha">Total tarjetas de débito: {{factura.totalTarjetasDebitos | currency}}</div>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <mat-divider></mat-divider>
            <div class="form-group form-row">
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Franquicia</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="tarjetaDebito.franquiciaTarjeta">
                            <mat-option *ngFor="let franquiciaTarjeta of franquiciasTarjetasDebitos"
                                [value]="franquiciaTarjeta">
                                {{franquiciaTarjeta.nombre}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-3">
                    <mat-form-field appearance="standard">
                        <mat-label>Banco</mat-label>
                        <mat-autocomplete #bancoTarjetaDebito="matAutocomplete" [displayWith]="verBancoTarjetaDebito">
                            <mat-option *ngFor="let banco of filtroBancosTarjetasDebitos | async" [value]="banco">
                                {{banco.razonSocial}}
                            </mat-option>
                        </mat-autocomplete>
                        <input matInput type="text" class="form-control-sm" [formControl]="controlBancoTarjetaDebito"
                            [matAutocomplete]="bancoTarjetaDebito">
                    </mat-form-field>
                </div>
                <div class="col-3">
                    <mat-form-field appearance="standard">
                        <mat-label>Cédula</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="tarjetaDebito.identificacion"
                            (change)="validarIdentificacionTarjetaDebito()"
                            [disabled]="deshabilitarTitularTarjetaDebito">
                    </mat-form-field>
                </div>
                <div class="col-3">
                    <mat-form-field appearance="standard">
                        <mat-label>Nombre</mat-label>
                        <input matInput type="text" [(ngModel)]="tarjetaDebito.nombre"
                            oninput="this.value = this.value.toUpperCase()"
                            [disabled]="deshabilitarTitularTarjetaDebito" class="form-control-sm">
                    </mat-form-field>
                </div>
                <div class="col-1">
                    <mat-form-field appearance="standard">
                        <mat-label>Titular</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="tarjetaDebito.titular"
                            (selectionChange)="asignarTitularTarjetaDebito()">
                            <mat-option [value]="si">{{si}}</mat-option>
                            <mat-option [value]="no">{{no}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Operador</mat-label>
                        <mat-select class="form-control-sm" [(ngModel)]="tarjetaDebito.operadorTarjeta">
                            <mat-option *ngFor="let operadorTarjeta of operadoresTarjetasDebitos"
                                [value]="operadorTarjeta">
                                {{operadorTarjeta.nombre}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Lote</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="tarjetaDebito.lote">
                    </mat-form-field>
                </div>
                <div class="col-2">
                    <mat-form-field appearance="standard">
                        <mat-label>Valor</mat-label>
                        <input matInput type="text" class="form-control-sm" [(ngModel)]="tarjetaDebito.valor"
                            [disabled]="true">
                    </mat-form-field>
                </div>
                <div class="col-1 iconos centrar">
                    <ng-container *ngIf="indiceTarjetaDebito==menosUno">
                        <button mat-icon-button mat-button (click)="agregarTarjetaDebito()">
                            <mat-icon>add</mat-icon>
                        </button>
                    </ng-container>
                    <ng-container *ngIf="indiceTarjetaDebito!=menosUno">
                        <button mat-icon-button mat-button (click)="confirmarEditarTarjetaDebito()">
                            <mat-icon>create</mat-icon>
                        </button>
                    </ng-container>
                </div>
            </div>
            <mat-divider></mat-divider>
            <div class="form-row">
                <div class="mat-elevation-z8 col-12">
                    <table mat-table [dataSource]="dataSourceTarjetasDebitos" matSort>
                        <!-- Posicion Columna -->
                        <ng-container matColumnDef="id">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>No.</th>
                            <td mat-cell *matCellDef="let i=index"> {{i+1}} </td>
                            <td mat-footer-cell *matFooterCellDef> Total </td>
                        </ng-container>
                        <!-- Franquicia Columna -->
                        <ng-container matColumnDef="franquicia">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Franquicia</th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.franquiciaTarjeta.nombre}}
                            </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Banco Columna -->
                        <ng-container matColumnDef="banco">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Banco</th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.banco.abreviatura}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Identificacion Columna -->
                        <ng-container matColumnDef="identificacion">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Cédula </th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.identificacion}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Nombre Columna -->
                        <ng-container matColumnDef="nombre">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Propietario </th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.nombre}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Titular Columna -->
                        <ng-container matColumnDef="titular">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Titular </th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.titular}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Operador Columna -->
                        <ng-container matColumnDef="operador">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Operador</th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.operadorTarjeta.nombre}}
                            </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Lote Columna -->
                        <ng-container matColumnDef="lote">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Lote</th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.lote}} </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <!-- Valor Columna -->
                        <ng-container matColumnDef="valor">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Valor </th>
                            <td mat-cell *matCellDef="let tarjetaDebito"> {{tarjetaDebito.valor | currency}} </td>
                            <td mat-footer-cell *matFooterCellDef> {{factura.totalTarjetasDebitos | currency}}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="acciones">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Acciones </th>
                            <td mat-cell *matCellDef="let i=index">
                                <button mat-raised-button color="primary" focusable="false"
                                    (click)="editarTarjetaDebito(i)">
                                    Editar
                                </button>&nbsp;
                                <button mat-raised-button color="warn" focusable="false"
                                    (click)="eliminarTarjetaDebito(i)">
                                    Eliminar
                                </button>
                            </td>
                            <td mat-footer-cell *matFooterCellDef></td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="columnasTarjetasDebito"></tr>
                        <tr mat-row *matRowDef="let row; columns: columnasTarjetasDebito;"></tr>
                        <tr mat-footer-row *matFooterRowDef="columnasTarjetasDebito"></tr>
                    </table>
                    <ng-container>
                        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
                    </ng-container>
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>
</div>